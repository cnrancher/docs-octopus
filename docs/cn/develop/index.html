<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">Octopus 开发指南 | Octopus</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Octopus 开发指南 | Octopus"><meta data-react-helmet="true" name="description" content="## Build management of Octopus"><meta data-react-helmet="true" property="og:description" content="## Build management of Octopus"><meta data-react-helmet="true" property="og:url" content="https://cnrancher.github.io/docs-octopus/docs/cn/develop">

<link data-react-helmet="true" rel="shortcut icon" href="/docs-octopus/img/favicon.ico">


<link rel="stylesheet" href="/docs-octopus/styles.6f397eb7.css">


<link rel="preload" href="/docs-octopus/styles.ce99c915.js" as="script">

<link rel="preload" href="/docs-octopus/runtime~main.caa66081.js" as="script">

<link rel="preload" href="/docs-octopus/main.98ae268c.js" as="script">

<link rel="preload" href="/docs-octopus/1.6b9be2be.js" as="script">

<link rel="preload" href="/docs-octopus/2.ecc18e87.js" as="script">

<link rel="preload" href="/docs-octopus/47.8660cb97.js" as="script">

<link rel="preload" href="/docs-octopus/8ffbebae.65a9d753.js" as="script">

<link rel="preload" href="/docs-octopus/17896441.213872fb.js" as="script">

<link rel="preload" href="/docs-octopus/540a1016.ca095b3c.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs-octopus/"><img class="navbar__logo" src="/docs-octopus/img/logo.png" alt="Octopus Logo"><strong class="navbar__title">Octopus</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-octopus/docs/cn/about">中文文档</a><a class="navbar__item navbar__link" href="/docs-octopus/docs/en/about">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="./eng" class="navbar__item navbar__link">English</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/cnrancher/octopus" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs-octopus/"><img class="navbar__logo" src="/docs-octopus/img/logo.png" alt="Octopus Logo"><strong class="navbar__title">Octopus</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/docs-octopus/docs/cn/about">中文文档</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs-octopus/docs/en/about">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="./eng" class="menu__link" position="right">English</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/cnrancher/octopus" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/about">关于 Octopus</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/quick-start">快速入门指南</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/install">安装部署</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeviceLink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/devicelink/about-dl">关于 DeviceLink</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/devicelink/state-of-dl">DeviceLink 的状态</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">适配器 (Adaptors)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/adaptor">关于适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/modbus">Modbus 适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/opc-ua">OPC-UA 适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/mqtt">MQTT 适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/ble">BLE 适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/dummy">Dummy 适配器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/mqtt-extension">适配器与MQTT集成</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-octopus/docs/cn/adaptors/develop">如何开发适配器</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs-octopus/docs/cn/develop">Octopus 开发指南</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/monitoring">关于监控</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/edge-ui">Edge UI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-octopus/docs/cn/faq">常见问题</a></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Octopus 开发指南</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="build-management-of-octopus"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-management-of-octopus" title="Direct link to heading">#</a>Build management of Octopus</h2><p>Octopus takes inspiration from <a href="https://maven.apache.org/">Maven</a> and provides a set of project build management based on <a href="https://www.gnu.org/software/make/manual/make.html">make</a>. Build management process consists of several stages, a stage consists of several actions. For convenience, the name of the action also represents the current stage. The overall flow relationship of action looks as below:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">          generate -&gt; mod -&gt; lint -&gt; build -&gt; package -&gt; deploy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         \ -&gt; test -&gt; verify -&gt; e2e</span></div></div></div></div></div><p>Explanation of each action:</p><table><thead><tr><th align="right">Action</th><th align="left">Usage</th></tr></thead><tbody><tr><td align="right"><code>generate</code>, <code>gen</code>, <code>g</code></td><td align="left">Generate deployment manifests and deepcopy/runtime.Object implementations of <code>octopus</code> via <a href="https://github.com/kubernetes-sigs/controller-tools/blob/master/cmd/controller-gen/main.go"><code>controller-gen</code></a>; Generate proto files of <code>adaptor</code> interfaces via <a href="https://github.com/protocolbuffers/protobuf"><code>protoc</code></a>.</td></tr><tr><td align="right"><code>mod</code>, <code>m</code></td><td align="left">Download <code>octopus</code> dependencies.</td></tr><tr><td align="right"><code>lint</code>, <code>l</code></td><td align="left">Verify <code>octopus</code> via <a href="https://github.com/golangci/golangci-lint"><code>golangci-lint</code></a>, roll back to <code>go fmt</code> and <code>go vet</code> if the installation fails. &lt;br/<br> Use <code>DIRTY_CHECK=true</code> to verify the whole project is in dirty tree or not.</td></tr><tr><td align="right"><code>build</code>, <code>b</code></td><td align="left">Compile <code>octopus</code> according to the type and architecture of the OS, generate the binary into <code>bin</code> directory. <br><br> Use <code>CROSS=true</code> to compile binaries of the supported platforms(search <code>constant.sh</code> file in this repo).</td></tr><tr><td align="right"><code>test</code>, <code>t</code></td><td align="left">Run unit tests.</td></tr><tr><td align="right"><code>verify</code>, <code>v</code></td><td align="left">Run integration tests with a Kubernetes cluster. <br><br> Use <code>CLUSTER_TYPE</code> to specify the type for local cluster, default is <code>k3d</code>. Instead of setting up a local cluster, you can also use environment variable <code>USE_EXISTING_CLUSTER=true</code> to point out an existing cluster, and then the integration tests will use the kubeconfig of the current environment to communicate with the existing cluster.</td></tr><tr><td align="right"><code>package</code>, <code>pkg</code>, <code>p</code></td><td align="left">Package Docker image.</td></tr><tr><td align="right"><code>e2e</code>, <code>e</code></td><td align="left">Run E2E tests.</td></tr><tr><td align="right"><code>deploy</code>, <code>dep</code>, <code>d</code></td><td align="left">Push Docker images and create manifest images for the current version. <br><br> Use <code>WITHOUT_MANIFEST=true</code> to prevent pushing manifest image, or <code>ONLY_MANIFEST=true</code> to push the manifest images only and <code>IGNORE_MISSING=true</code> to warn on missing images defined in platform list if needed.</td></tr></tbody></table><p>Executing a stage can run <code>make octopus &lt;stage name&gt;</code>, for example, when executing the <code>test</code> stage, please run <code>make octopus test</code>. To execute a stage will execute all actions in the previous sequence, if running <code>make octopus test</code>, it actually includes executing <code>generate</code>, <code>mod</code>, <code>lint</code>, <code>build</code> and <code>test</code> actions.</p><p>To run an action by adding <code>only</code> command, for example, if only run <code>build</code> action, please use <code>make octopus build only</code>.</p><p>To combine multiple actions can use a comma list, for example, if want to run <code>build</code>, <code>package</code> and <code>deploy</code> actions orderly, please use <code>make octopus build,package,deploy</code>.</p><p>Integrate with <a href="https://github.com/rancher/dapper"><code>dapper</code></a> via <code>BY</code> environment variable, for example, if only run <code>build</code> action via <a href="https://github.com/rancher/dapper"><code>dapper</code></a>, please use <code>BY=dapper make octopus build only</code>. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="usage-cases"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#usage-cases" title="Direct link to heading">#</a>Usage cases</h3><p>Suppose to try the following example on Mac:</p><ol><li><p>Run in the localhost, the current environment will install additional dependencies. You will get a corresponding warning if any installation fails.</p><ul><li><code>make octopus build</code>: execute <code>build</code> stage, then get a <code>darwin/amd64</code> execution binary.</li><li><code>make octopus test only</code>: execute <code>test</code> action on <code>darwin/amd64</code> platform.</li><li><code>REPO=somebody OS=linux ARCH=amd64 make octopus package</code>: execute <code>package</code> stage, then get a <code>linux/amd64</code> execution binary and an octopus <code>linux/amd64</code> image of <code>somebody</code> repo.</li><li><code>CLUSTER_TYPE=kind make octopus verify only</code>: execute <code>verify</code> action with <a href="https://github.com/kubernetes-sigs/kind"><code>kind</code></a> cluster.</li></ul></li><li><p>Support multi-arch in the localhost.</p><ul><li><code>CROSS=true make octopus build only</code>: execute <code>build</code> action, then get all execution binaries of supported platform.</li><li><code>CROSS=true make octopus test only</code>: <em>crossed testing isn&#x27;t supported currently</em>.</li><li><code>CROSS=true REPO=somebody make octopus package only</code>: execute <code>package</code> action, then get all supported platform images of <code>somebody</code> repo.<ul><li><code>make octopus package only</code>: <em>packaging <code>darwin</code> platform image isn&#x27;t supported currently</em>.</li></ul></li><li><code>CROSS=true REPO=somebody make octopus deploy only</code>: execute <code>deploy</code> action, then push all supported platform images to <code>somebody</code> repo, also create <a href="https://docs.docker.com/engine/reference/commandline/manifest/">manifest images</a> for the current version.<ul><li><code>make octopus deploy only</code>: <em>deploying <code>darwin</code> platform image isn&#x27;t supported currently</em>.</li></ul></li></ul></li><li><p>In <a href="https://github.com/rancher/dapper"><code>dapper</code></a> mode, no additional dependencies are required in the current environment, which suitable for constructing CI / CD and good to the portability of the environment.</p><ul><li><code>BY=dapper make octopus build</code>: execute <code>build</code> stage, then get a <code>linux/amd64</code> execution binary.</li><li><code>BY=dapper make octopus test</code>: execute <code>test</code> stage on <code>linux/amd64</code> platform.</li><li><code>BY=dapper REPO=somebody make octopus package only</code>: execute <code>package</code> action and get an octopus <code>linux/amd64</code> image of <code>sombody</code> repo.</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes" title="Direct link to heading">#</a>Notes</h3><p>In <a href="https://github.com/rancher/dapper"><code>dapper</code></a> mode:</p><ul><li>Using <code>USE_EXISTING_CLUSTER=true</code> is <strong>NOT ALLOWED</strong>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="build-management-of-adaptors"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-management-of-adaptors" title="Direct link to heading">#</a>Build management of Adaptors</h2><p>The build management of Adaptors is the similar to Octopus, except that the execution is different. Executing a stage of any adaptor can run <code>make adaptor &lt;adaptor name&gt; &lt;stage name&gt;</code>. Please view <a href="../adaptors/develop.md">Develop Adaptors</a> for more details.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="build-management-for-all-components"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-management-for-all-components" title="Direct link to heading">#</a>Build management for all components</h2><p>With the increase of components, the operation of building them one by one becomes more cumbersome. Therefore, by specifying a stage or action, the build management performs the same stage or action for all components. For example, running <code>make all test</code> will execute the <code>test</code> stage of Octopus and all Adaptors. To execute an action just type with an <code>only</code> suffix command.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="contributor-workflow"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#contributor-workflow" title="Direct link to heading">#</a>Contributor workflow</h2><p>Contributing is welcome, please view <a href="https://github.com/cnrancher/octopus/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> for more details.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cnrancher/docs-octopus/edit/master/website/docs/cn/develop.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-octopus/docs/cn/adaptors/develop"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« 如何开发适配器</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-octopus/docs/cn/monitoring"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">关于监控 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#build-management-of-octopus" class="contents__link">Build management of Octopus</a><ul><li><a href="#usage-cases" class="contents__link">Usage cases</a></li><li><a href="#notes" class="contents__link">Notes</a></li></ul></li><li><a href="#build-management-of-adaptors" class="contents__link">Build management of Adaptors</a></li><li><a href="#build-management-for-all-components" class="contents__link">Build management for all components</a></li><li><a href="#contributor-workflow" class="contents__link">Contributor workflow</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs-octopus/docs/cn/about">关于 Octopus</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-octopus/docs/cn/quick-start">快速入门指南</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-octopus/docs/cn/adaptors/develop">开发适配器</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">社区相关</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://www.rancher.cn">Rancher 官网</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://slack.rancher.io">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/cnrancher/octopus">GitHub</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/cnrancher/octopus-chart">Helm Chart</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 <a href="https://www.rancher.cn/">Rancher Labs, Inc.</a> Built with love.</div></div></div></footer>
</div>

<script src="/docs-octopus/styles.ce99c915.js"></script>

<script src="/docs-octopus/runtime~main.caa66081.js"></script>

<script src="/docs-octopus/main.98ae268c.js"></script>

<script src="/docs-octopus/1.6b9be2be.js"></script>

<script src="/docs-octopus/2.ecc18e87.js"></script>

<script src="/docs-octopus/47.8660cb97.js"></script>

<script src="/docs-octopus/8ffbebae.65a9d753.js"></script>

<script src="/docs-octopus/17896441.213872fb.js"></script>

<script src="/docs-octopus/540a1016.ca095b3c.js"></script>


</body>
</html>